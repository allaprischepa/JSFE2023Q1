(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var n=e.g.document;if(!t&&n&&(n.currentScript&&(t=n.currentScript.src),!t)){var a=n.getElementsByTagName("script");if(a.length)for(var s=a.length-1;s>-1&&!t;)t=a[s--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t+"../"})();const t=e.p+"assets/sounds/lose.mp3",n=e.p+"assets/sounds/win.mp3",a=e.p+"assets/sounds/click.mp3",s=e.p+"assets/sounds/tick.mp3";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,s,i,r,o=[],c=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=i.call(n)).done)&&(o.push(a.value),o.length!==t);c=!0);}catch(e){l=!0,s=e}finally{try{if(!c&&null!=n.return&&(r=n.return(),Object(r)!==r))return}finally{if(l)throw s}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function c(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(void 0,s=function(e,t){if("object"!==i(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,"string");if("object"!==i(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(a.key),"symbol"===i(s)?s:String(s)),a)}var s}(new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var i,o,l;return i=e,o=[{key:"init",value:function(){this.selectors={main:"minesweeper",header:"minesweeper__header",mode:"minesweeper__mode",minesCount:"minesweeper__mines-count",gameBlock:"minesweeper__game",stat:"minesweeper__stat",remaining:"stat__remaining",flags:"stat__flags",steps:"stat__steps",time:"stat__time",restart:"restart",field:"minesweeper__field",theme:"minesweeper__theme",sound:"minesweeper__sound",flagged:"type_f",closed:"cell_closed",opened:"cell_opened",exploded:"cell_exploded",scoreBlock:"minesweeper__score",popup:"popup",overlay:"overlay",popupMessage:"popup__message",popupButton:"popup__button"},this.body=document.querySelector("body"),this.body.className="page",document.documentElement.className="theme-".concat(e.getProperty("theme")),this.mainBlock=this.addMainBlock(),this.themeSwitcherBlock=this.addThemeSwitcherBlock(),this.soundSwitcherBlock=this.addSoundSwitcherBlock();var i=r(this.addSettingsBlock(),2);this.modeBlock=i[0],this.countBlock=i[1],this.gameBlock=this.addGameBlock(),this.gameFieldBlock=this.addGameFieldBlock(),this.scoreBlock=this.addScoreBlock();var o=r(this.addPopup(),2);this.overlayBlock=o[0],this.popupBlock=o[1],this.soundLose=new Audio(t),this.soundWin=new Audio(n),this.soundClick=new Audio(a),this.soundTick=new Audio(s),this.listenThemeChange(),this.listenSoundChange(),this.listenModeChange(),this.listenMinesCountChange(),this.listenRestartButtonClick(),this.initializeGame(!1)}},{key:"addMainBlock",value:function(){var e=document.createElement("div");e.classList=this.selectors.main,e.classList.add("container");var t=document.createElement("header"),n=document.createElement("h1");return t.classList="container",n.classList=this.selectors.header,n.innerText="Minesweeper",t.appendChild(n),this.body.appendChild(t),["first","second","third"].forEach((function(t){var n=document.createElement("div");n.classList="minesweeper__row-".concat(t),e.appendChild(n)})),this.body.appendChild(e),e}},{key:"addThemeSwitcherBlock",value:function(){var t=this.mainBlock.querySelector(".minesweeper__row-first"),n=document.createElement("div");n.classList=this.selectors.theme,n.setAttribute("title","Theme Dark/Light");var a=document.createElement("input"),s="theme-switcher";a.setAttribute("type","checkbox"),a.setAttribute("id",s),a.classList="theme-switcher__input","light"===e.getProperty("theme")&&(a.checked=!0);var i=document.createElement("span");i.classList="theme-switcher__toggle";var r=document.createElement("label");return r.setAttribute("for",s),r.appendChild(a),r.appendChild(i),n.appendChild(r),t.appendChild(n),this.mainBlock.appendChild(t),n}},{key:"addSoundSwitcherBlock",value:function(){var t=this.mainBlock.querySelector(".minesweeper__row-first"),n=document.createElement("div");n.classList=this.selectors.sound,n.setAttribute("title","Sound On/Off");var a=document.createElement("input"),s="sound-switcher";a.setAttribute("type","checkbox"),a.setAttribute("id",s),a.classList="sound-switcher__input","on"===e.getProperty("sound")&&(a.checked=!0);var i=document.createElement("span");i.classList="sound-switcher__toggle";var r=document.createElement("label");return r.setAttribute("for",s),r.appendChild(a),r.appendChild(i),n.appendChild(r),t.appendChild(n),this.mainBlock.appendChild(t),n}},{key:"addSettingsBlock",value:function(){var t=this.mainBlock.querySelector(".minesweeper__row-second"),n=document.createElement("div");n.classList=this.selectors.mode;var a=document.createElement("div");a.classList="setting-name",a.innerText="Mode",n.appendChild(a);var s=document.createElement("div");s.classList="setting-block",n.appendChild(s),["easy","medium","hard"].forEach((function(t){var n=document.createElement("input"),a="mode-".concat(t),i={type:"radio",name:"mode",id:a,value:t,label:e.capitalize(t)};Object.entries(i).forEach((function(e){var t=r(e,2),a=t[0],s=t[1];n.setAttribute(a,s)})),t===e.getProperty("mode")&&(n.checked=!0),n.classList=a,s.appendChild(n)}));var i=document.createElement("div");i.classList=this.selectors.minesCount;var o=document.createElement("div");o.classList="setting-name",o.innerText="Mines",i.appendChild(o);var c=document.createElement("div");c.classList="setting-block",i.appendChild(c);var l=document.createElement("input"),d=document.createElement("span");d.classList="mines-count__value",d.innerText=e.getProperty("minesCount");var u="count",p={type:"range",min:10,max:99,step:1,id:u,name:u,value:e.getProperty("minesCount"),class:u};return Object.entries(p).forEach((function(e){var t=r(e,2),n=t[0],a=t[1];l.setAttribute(n,a)})),c.appendChild(l),c.appendChild(d),t.appendChild(n),t.appendChild(i),this.mainBlock.appendChild(t),[n,i]}},{key:"addGameBlock",value:function(){var t=this.mainBlock.querySelector(".minesweeper__row-third"),n=document.createElement("div");n.classList=this.selectors.gameBlock,t.appendChild(n),this.mainBlock.appendChild(t);var a=document.createElement("div");a.classList=this.selectors.stat,n.appendChild(a);var s=document.createElement("div"),i=document.createElement("div");i.classList=this.selectors.remaining,i.innerText=e.getProperty("minesCount"),s.appendChild(i);var r=document.createElement("div");r.classList=this.selectors.flags,r.innerText=0,s.appendChild(r);var o=document.createElement("div"),c=document.createElement("button");c.classList=this.selectors.restart,c.setAttribute("title","Restart"),o.appendChild(c);var l=document.createElement("div"),d=document.createElement("div");d.classList=this.selectors.time,d.innerText=0,l.appendChild(d);var u=document.createElement("div");return u.classList=this.selectors.steps,u.innerText=0,l.appendChild(u),a.appendChild(s),a.appendChild(o),a.appendChild(l),n}},{key:"addGameFieldBlock",value:function(){var e=document.createElement("div");return this.gameBlock.appendChild(e),e}},{key:"addScoreBlock",value:function(){var e=document.createElement("div");e.classList="minesweeper__row-fourth";var t=document.createElement("div");return t.classList=this.selectors.scoreBlock,e.appendChild(t),this.mainBlock.appendChild(e),t}},{key:"addPopup",value:function(){var e=this,t=document.createElement("div");t.classList=this.selectors.overlay,this.body.appendChild(t);var n=document.createElement("div"),a=document.createElement("div"),s=document.createElement("button");return s.innerText="OK",n.classList=this.selectors.popup,a.classList=this.selectors.popupMessage,s.classList=this.selectors.popupButton,n.appendChild(a),n.appendChild(s),this.body.appendChild(n),[t,s].forEach((function(t){t.addEventListener("click",(function(){e.closePopup()}))})),[t,n]}},{key:"addCells",value:function(){var t=e.getSavedState(),n=e.getRowsCount();this.gameFieldBlock.innerHTML="",this.gameFieldBlock.classList="".concat(this.selectors.field," field_rows_").concat(n),this.gameBlock.classList="".concat(this.selectors.gameBlock," game_rows_").concat(n);for(var a=0;a<n;a+=1)for(var s=0;s<n;s+=1){var i=document.createElement("div");i.id="cell_".concat(a,"_").concat(s),i.classList="cell ".concat(i.id),t[i.id].opened?(i.classList.add(this.selectors.opened),i.classList.add("type_".concat(t[i.id].type)),t[i.id].exploded&&i.classList.add(this.selectors.exploded)):(t[i.id].flagged&&i.classList.add("type_f"),i.classList.add(this.selectors.closed)),this.gameFieldBlock.appendChild(i)}this.listenClickOnCell()}},{key:"listenThemeChange",value:function(){this.themeSwitcherBlock.querySelector("input").addEventListener("change",(function(){var t="light"===e.getProperty("theme")?"dark":"light";e.updateProperty("theme",t),document.documentElement.className="theme-".concat(t)}))}},{key:"listenSoundChange",value:function(){this.soundSwitcherBlock.querySelector("input").addEventListener("change",(function(){var t="on"===e.getProperty("sound")?"off":"on";e.updateProperty("sound",t)}))}},{key:"listenModeChange",value:function(){var t=this;this.modeBlock.querySelectorAll('input[name="mode"]').forEach((function(n){n.addEventListener("change",(function(n){var a=n.target.getAttribute("value"),s=e.getDefaultMinesCount(a),i=t.countBlock.querySelector('input[name="count"]');i.value=s,i.dispatchEvent(new Event("change")),e.updateProperty("mode",a),t.initializeGame()}))}))}},{key:"listenMinesCountChange",value:function(){var t=this,n=this.countBlock.querySelector('input[name="count"]');n.addEventListener("input",(function(e){t.countBlock.querySelector(".mines-count__value").innerText=e.target.value})),n.addEventListener("change",(function(n){var a=t.countBlock.querySelector(".mines-count__value"),s=n.target,i=s.value;a.innerText=i,s.setAttribute("value",i),e.updateProperty("minesCount",i),t.initializeGame()}))}},{key:"listenClickOnCell",value:function(){var t=this;this.gameFieldBlock.querySelectorAll(".cell").forEach((function(n){n.addEventListener("click",(function(a){t.isMarked(n)||e.getProperty("gameFinished")?a.preventDefault():(e.getProperty("gameStarted")||t.startGame(),e.getProperty("firstClick")&&(e.setMines(n.id),e.updateProperty("firstClick",0)),t.isClosed(n)?(e.updateProperty("steps",e.getProperty("steps")+1),t.setSteps(),t.openCell(n.id,!1,!0)):t.openAdjacent(n.id))})),n.addEventListener("contextmenu",(function(a){a.preventDefault(),e.getProperty("gameFinished")||(e.getProperty("gameStarted")||t.startGame(),t.isClosed(n)&&(t.isMarked(n)?t.markFlagged(n.id,!1):e.getProperty("flags")<e.getProperty("minesCount")&&(t.markFlagged(n.id),t.playSound("soundTick"))))}))}))}},{key:"listenRestartButtonClick",value:function(){var e=this,t=this.gameBlock.querySelector(".".concat(this.selectors.restart));t&&t.addEventListener("click",(function(){return e.initializeGame()}))}},{key:"initializeGame",value:function(){arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?e.getProperty("gameStarted")&&this.startTimer():(e.updateProperty("gameStarted",0),e.updateProperty("gameFinished",0),e.updateProperty("firstClick",1),e.updateProperty("flags",0),e.updateProperty("steps",0),e.setCells(),this.clearTimer()),this.setFlags(),this.setRemaining(),this.setSteps(),this.setTime(),this.addCells(),this.setScore()}},{key:"isMarked",value:function(e){return e.classList.contains(this.selectors.flagged)}},{key:"isClosed",value:function(e){return e.classList.contains(this.selectors.closed)}},{key:"markFlagged",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=e.getSavedState(),s=this.gameFieldBlock.querySelector("#".concat(t)),i=e.getProperty("flags");n?a[t].flagged||(a[t].flagged=1,s.classList.add(this.selectors.flagged),e.updateProperty("flags",i+1)):a[t].flagged&&(a[t].flagged=0,s.classList.remove(this.selectors.flagged),e.updateProperty("flags",i-1)),e.setSavedState(a),this.setFlags(),this.setRemaining()}},{key:"startGame",value:function(){e.updateProperty("gameStarted",1),this.startTimer()}},{key:"startTimer",value:function(){var t=this,n=this.gameBlock.querySelector(".".concat(this.selectors.time));this.setTime(),this.timer=setInterval((function(){var a=e.getProperty("time")+1;n.innerText=a,e.updateProperty("time",a),999===a&&t.finishGame()}),1e3)}},{key:"setTime",value:function(){this.gameBlock.querySelector(".".concat(this.selectors.time)).innerText=e.getProperty("time")}},{key:"finishGame",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=e.getSavedState();e.updateProperty("gameStarted",0),e.updateProperty("gameFinished",1),e.updateProperty("firstClick",1),n?(Object.entries(a).forEach((function(e){var n=r(e,2),a=n[0],s=n[1];"m"!==s.type||s.flagged||t.markFlagged(a)})),this.openPopup(n),this.playSound("soundWin"),this.updateScore()):(Object.entries(a).forEach((function(e){var n=r(e,2),a=n[0],s=n[1];"m"!==s.type||s.opened||s.flagged||(t.markFlagged(a,!1),t.openCell(a,!0))})),this.openPopup(n),this.playSound("soundLose")),this.stopTimer()}},{key:"clearTimer",value:function(){this.gameBlock.querySelector(".stat__time").innerText=0,e.updateProperty("time",0),this.stopTimer()}},{key:"stopTimer",value:function(){clearInterval(this.timer)}},{key:"setFlags",value:function(){this.gameBlock.querySelector(".".concat(this.selectors.flags)).innerText=e.getProperty("flags")}},{key:"setRemaining",value:function(){this.gameBlock.querySelector(".".concat(this.selectors.remaining)).innerText=e.getProperty("minesCount")-e.getProperty("flags")}},{key:"setSteps",value:function(){this.gameBlock.querySelector(".".concat(this.selectors.steps)).innerText=e.getProperty("steps")}},{key:"setScore",value:function(){var t=e.getSavedScore(),n='<div class="score__header">Score</div>';n+='<div class="score__table">',n+='<div class="table__head"><span>Mode</span><span>Mines</span><span>Time</span><span>Steps</span></div>',t.length&&t.forEach((function(e){n+='<div class="table__row"><span>'.concat(e.mode,"</span><span>").concat(e.mines,"</span><span>").concat(e.time,"</span><span>").concat(e.steps,"</span></div>")}));for(var a=0;a<10-t.length;a+=1)n+='<div class="table__row"><span> </span><span> </span><span> </span><span> </span></div>';n+="</div>",this.scoreBlock.innerHTML=n}},{key:"openCell",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=e.getSavedState();if(!s[t].opened&&!s[t].flagged){var i=e.getRowsCount(),o=this.gameFieldBlock.querySelector("#".concat(t));if(o.classList.remove(this.selectors.closed),o.classList.add(this.selectors.opened),o.classList.add("type_".concat(s[t].type)),s[t].opened=1,e.setSavedState(s),s[t].flagged&&this.markFlagged(t,!1),0===s[t].type)for(var c=r(t.split("_").map((function(e){return parseInt(e,10)})),3),l=c[1],d=c[2],u=l-1;u<=l+1;u+=1)for(var p=d-1;p<=d+1;p+=1)if(u>=0&&u<i&&p>=0&&p<i){var m="cell_".concat(u,"_").concat(p);void 0===s[m]||u===l&&p===d||"m"!==s[m].type&&this.openCell(m)}if(!n){"m"===s[t].type?(s[t].exploded=1,o.classList.add(this.selectors.exploded),e.setSavedState(s),this.finishGame()):a&&this.playSound("soundClick");var h=e.checkIfWon(s);h&&this.finishGame(h)}}}},{key:"openAdjacent",value:function(t){var n=this,a=e.getSavedState(),s=e.getRowsCount();if(a[t].opened&&!a[t].flagged){for(var i=!0,o=r(t.split("_").map((function(e){return parseInt(e,10)})),3),c=o[1],l=o[2],d=[],u=c-1;u<=c+1;u+=1)for(var p=l-1;p<=l+1;p+=1)if(u>=0&&u<s&&p>=0&&p<s){var m="cell_".concat(u,"_").concat(p);if(void 0!==a[m]&&(u!==c||p!==l)&&(d.push(m),"m"===a[m].type&&!a[m].flagged)){i=!1;break}}i&&(e.updateProperty("steps",e.getProperty("steps")+1),this.setSteps(),this.playSound("soundClick"),d.forEach((function(e){n.openCell(e)})))}}},{key:"playSound",value:function(t){"on"===e.getProperty("sound")&&this[t].play()}},{key:"openPopup",value:function(){var t="";if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]){var n=e.getProperty("time"),a=e.getProperty("steps");t="<div>Hooray! You found all mines in ".concat(n," seconds and ").concat(a," moves!</div>"),t+='<div class="won-emodji"></div>'}else t="<div>Game over. Try again.</div>",t+='<div class="lost-emodji"></div>';this.popupBlock.querySelector(".".concat(this.selectors.popupMessage)).innerHTML=t,this.popupBlock.classList.add("open"),this.body.classList.add("frozen")}},{key:"closePopup",value:function(){this.popupBlock.classList.remove("open"),this.body.classList.remove("frozen")}},{key:"updateScore",value:function(){var t=e.getSavedScore();t.unshift({mode:e.getProperty("mode"),mines:e.getProperty("minesCount"),time:e.getProperty("time"),steps:e.getProperty("steps")}),t.splice(10),e.setSavedScore(t),this.setScore()}}],l=[{key:"getProperty",value:function(t){var n="",a=localStorage.getItem(t);if(a)["minesCount","flags","gameStarted","firstClick","gameFinished","steps","time"].includes(t)&&(a=+a);else{switch(t){case"mode":n="easy";break;case"minesCount":n=10;break;case"theme":n="light";break;case"sound":n="on";break;case"flags":case"gameStarted":case"gameFinished":case"steps":case"time":n=0;break;case"firstClick":n=1}a=e.updateProperty(t,n)}return a}},{key:"updateProperty",value:function(e,t){return localStorage.setItem(e,t),t}},{key:"getRowsCount",value:function(){switch(e.getProperty("mode")){case"easy":return 10;case"medium":return 15;default:return 25}}},{key:"getDefaultMinesCount",value:function(e){switch(e){case"easy":return 10;case"medium":return 40;default:return 99}}},{key:"getSavedState",value:function(){var t=localStorage.getItem("savedState");return t?JSON.parse(t):e.setCells()}},{key:"setSavedState",value:function(t){var n=JSON.stringify(t);e.updateProperty("savedState",n)}},{key:"setCells",value:function(){for(var t=e.getRowsCount(),n={},a=0;a<t;a+=1)for(var s=0;s<t;s+=1)n["cell_".concat(a,"_").concat(s)]={type:0,flagged:0,opened:0};return e.setSavedState(n),n}},{key:"setMines",value:function(t){for(var n=e.getRowsCount(),a=e.getSavedState(),s=0;s<e.getProperty("minesCount");){var i=Math.floor(Math.random()*n),r=Math.floor(Math.random()*n),o="cell_".concat(i,"_").concat(r);if(o!==t&&"m"!==a[o].type){a[o].type="m",s+=1;for(var c=i-1;c<=i+1;c+=1)for(var l=r-1;l<=r+1;l+=1){var d="cell_".concat(c,"_").concat(l);void 0===a[d]||c===i&&l===r||"m"!==a[d].type&&(a[d].type+=1)}}}e.setSavedState(a)}},{key:"checkIfWon",value:function(e){return Object.values(e).filter((function(e){return"m"!==e.type})).every((function(e){return 1===e.opened}))}},{key:"capitalize",value:function(e){var t=e.charAt(0).toUpperCase(),n=e.slice(1);return"".concat(t).concat(n)}},{key:"getSavedScore",value:function(){var e=localStorage.getItem("savedScore");return e?JSON.parse(e):[]}},{key:"setSavedScore",value:function(t){var n=JSON.stringify(t);e.updateProperty("savedScore",n)}}],o&&c(i.prototype,o),l&&c(i,l),Object.defineProperty(i,"prototype",{writable:!1}),e}())).init()})();